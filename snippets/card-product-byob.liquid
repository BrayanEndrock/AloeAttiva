{% comment %}
    Renders a product card

    Accepts:
    - card_product: {Object} Product Liquid object (optional)
    - media_aspect_ratio: {String} Size of the product image card. Values are "square" and "portrait". Default is "square" (optional)
    - show_secondary_image: {Boolean} Show the secondary image on hover. Default: false (optional)
    - show_vendor: {Boolean} Show the product vendor. Default: false
    - show_rating: {Boolean} Show the product rating. Default: false
    - extend_height: {Boolean} Card height extends to available container space. Default: true (optional)
    - lazy_load: {Boolean} Image should be lazy loaded. Default: true (optional)

    Usage:
    {% render 'card-product', show_vendor: section.settings.show_vendor %}
{% endcomment %}

{%- liquid
  assign variant_card = card_product.first_available_variant
  assign featured_media_aspect_ratio = card_product.featured_media.aspect_ratio

  if card_product.featured_media.aspect_ratio == nil
    assign featured_media_aspect_ratio = 1
  endif

  assign cart_count_product = cartCountProduct
  assign cart_count_product_subs = 0
-%}

{{ 'component-rating.css' | asset_url | stylesheet_tag }}

{%- if card_product and card_product != empty -%}
  {%- liquid
    assign ratio = 1
    if card_product.featured_media and media_aspect_ratio == 'portrait'
      assign ratio = 0.8
    elsif card_product.featured_media and media_aspect_ratio == 'adapt'
      assign ratio = card_product.featured_media.aspect_ratio
    endif
    if ratio == 0 or ratio == nil
      assign ratio = 1
    endif
    assign dataImage = card_product
    if card_product.metafields.global.image_byob
      assign dataImage = card_product.metafields.global.image_byob.value
    endif
  -%}
  <div class="card-wrapper underline-links-hover{% if cart_count_product > 0 or cart_count_product_subs > 0 %} showBtnDelete{% endif %}{% if byobSubs %} product--subs{% endif %}"
    data-id="{{card_product.selected_or_first_available_variant.id}}" 
    data-handle="{{card_product.handle}}" 
    data-product-image="{%- if dataImage.width >= 165 -%}{{ dataImage | img_url: '165x' }} 165w,{%- endif -%}
    {%- if dataImage.width >= 360 -%}{{ dataImage | img_url: '360x' }} 360w,{%- endif -%}
    {%- if dataImage.width >= 533 -%}{{ dataImage | img_url: '533x' }} 533w,{%- endif -%}
    {%- if dataImage.width >= 720 -%}{{ dataImage | img_url: '720x' }} 720w,{%- endif -%}
    {%- if dataImage.width >= 940 -%}{{ dataImage | img_url: '940x' }} 940w,{%- endif -%}
    {%- if dataImage.width >= 1066 -%}{{ dataImage | img_url: '1066x' }} 1066w{%- endif -%}" 
    data-product-image30="{{ dataImage | img_url: '533x' }}" 
    data-product-image-width="{{ dataImage.width }}" 
    data-product-image-height="{{ dataImage.height }}" 
    data-product-title="{{ card_product.title }}" 
    data-product-price="{{ card_product.price | money }}" 
    data-product-image-alt="{{ card_product.title }}">
    <div class="card
      card--{{ settings.card_style }}
      {% if card_product.featured_media %} card--media{% else %} card--text{% endif %}
      {% if settings.card_style == 'card' %} color-{{ settings.card_color_scheme }}{% endif %}
      {% if extend_height %} card--extend-height{% endif %}
      {% if card_product.featured_media == nil and settings.card_style == 'card' %} ratio{% endif %}
      {% if cart_count_product > 0 or cart_count_product_subs > 0 %} showBtnDelete{% endif %}{% if byobSubs %} product--subs{% endif %}"
      style="--ratio-percent: {{ 1 | divided_by: ratio | times: 100 }}%;"
      id="product-card--{{ card_product.handle }}"
      data-id="{{card_product.id}}" data-variant-id="{{variant_card.id}}" data-handle="{{card_product.handle}}" 
      onclick="void(0)"
    >
      <input name="updates[{{variant_card.id}}]" type="hidden" data-count-onetime="{{ cart_count_product }}" data-count-subscription="{{ cart_count_product_subs }}" data-id="{{card_product.variants.first.id}}{% comment %}{{variant_card.id}}{% endcomment%}"  data-product-selling-plan-id="{{productSellingPlanId}}" data-name="{{ card_product.title }}" data-price="{{ variant_card.price }}" value="{{ cart_count_product }}" class="product_byob_quantity" />
      <div class="card__inner {% if settings.card_style == 'standard' %}color-{{ settings.card_color_scheme }}{% endif %}{% if card_product.featured_media or settings.card_style == 'standard' %} ratio{% endif %}" style="--ratio-percent: {{ 1 | divided_by: ratio | times: 100 }}%;">
        {%- if card_product.featured_media -%}
          <div class="card__media">
            <div class="media media--transparent media--hover-effect">
              <img
                srcset="{%- if card_product.featured_media.width >= 165 -%}{{ card_product.featured_media | img_url: '165x' }} 165w,{%- endif -%}
                  {%- if card_product.featured_media.width >= 360 -%}{{ card_product.featured_media | img_url: '360x' }} 360w,{%- endif -%}
                  {%- if card_product.featured_media.width >= 533 -%}{{ card_product.featured_media | img_url: '533x' }} 533w,{%- endif -%}
                  {%- if card_product.featured_media.width >= 720 -%}{{ card_product.featured_media | img_url: '720x' }} 720w,{%- endif -%}
                  {%- if card_product.featured_media.width >= 940 -%}{{ card_product.featured_media | img_url: '940x' }} 940w,{%- endif -%}
                  {%- if card_product.featured_media.width >= 1066 -%}{{ card_product.featured_media | img_url: '1066x' }} 1066w,{%- endif -%}
                  {{ card_product.featured_media | img_url: 'master' }} {{ card_product.featured_media.width }}w"
                src="{{ card_product.featured_media | img_url: '533x' }}"
                sizes="(min-width: {{ settings.page_width }}px) {{ settings.page_width | minus: 130 | divided_by: 4 }}px, (min-width: 990px) calc((100vw - 130px) / 4), (min-width: 750px) calc((100vw - 120px) / 3), calc((100vw - 35px) / 2)"
                alt="{{ card_product.featured_media.alt | escape }}"
                class="motion-reduce"
                loading="lazy"
                width="{{ card_product.featured_media.width }}"
                height="{{ card_product.featured_media.height }}"
              >

              {%- if card_product.media[1] != nil and show_secondary_image -%}
                <img
                  srcset="{%- if card_product.media[1].width >= 165 -%}{{ card_product.media[1] | img_url: '165x' }} 165w,{%- endif -%}
                    {%- if card_product.media[1].width >= 360 -%}{{ card_product.media[1] | img_url: '360x' }} 360w,{%- endif -%}
                    {%- if card_product.media[1].width >= 533 -%}{{ card_product.media[1] | img_url: '533x' }} 533w,{%- endif -%}
                    {%- if card_product.media[1].width >= 720 -%}{{ card_product.media[1] | img_url: '720x' }} 720w,{%- endif -%}
                    {%- if card_product.media[1].width >= 940 -%}{{ card_product.media[1] | img_url: '940x' }} 940w,{%- endif -%}
                    {%- if card_product.media[1].width >= 1066 -%}{{ card_product.media[1] | img_url: '1066x' }} 1066w,{%- endif -%}
                    {{ card_product.media[1] | img_url: 'master' }} {{ card_product.media[1].width }}w"
                  src="{{ card_product.media[1] | img_url: '533x' }}"
                  sizes="(min-width: {{ settings.page_width }}px) {{ settings.page_width | minus: 130 | divided_by: 4 }}px, (min-width: 990px) calc((100vw - 130px) / 4), (min-width: 750px) calc((100vw - 120px) / 3), calc((100vw - 35px) / 2)"
                  alt="{{ card_product.media[1].alt | escape }}"
                  class="motion-reduce"
                  loading="lazy"
                  width="{{ card_product.media[1].width }}"
                  height="{{ card_product.media[1].height }}"
                >
              {%- endif -%}
            </div>
          </div>
        {%- endif -%}
        <div class="card__content">
          {% comment %}
          <div class="card__information">
            <h3 class="card__heading">
              <a href="{{ card_product.url | default: '#' }}" class="full-unstyled-link">
                {{ card_product.title | escape }}
              </a>
            </h3>
          </div>
          <div class="card__badge {{ settings.badge_position }}">
            {%- if card_product.available == false -%}
              <span class="badge badge--bottom-left color-{{ settings.sold_out_badge_color_scheme }}">{{ 'products.product.sold_out' | t }}</span>
            {%- elsif card_product.compare_at_price > card_product.price and card_product.available -%}
              <span class="badge badge--bottom-left color-{{ settings.sale_badge_color_scheme }}">{{ 'products.product.on_sale' | t }}</span>
            {%- endif -%}
          </div>
          {% endcomment %}


          <modal-opener class="product-popup-modal__opener no-js-hidden" data-modal="#PopupModal-{{ section.id }}-{{ card_product.id }}" style="width:100%;">
            <button id="ProductPopup-{{ card_product }}" class="btn product-popup-modal__button" type="button" aria-haspopup="dialog">Show More</button>
          </modal-opener>
          <modal-dialog id="PopupModal-{{ section.id }}-{{ card_product.id }}" class="product-popup-modal">
            <div role="dialog" aria-label="Close" aria-modal="true" class="product-popup-modal__content" tabindex="-1">
              <button id="ModalClose-{{ section.id }}-{{card_product.id }}" type="button" class="product-popup-modal__toggle" aria-label="{{ 'accessibility.close' | t }}">{% render 'icon-close' %}</button>
              <div class="product-popup-modal__content-info">
                
                
                {%- liquid
                  assign sectionSettingsHide_variants = false
                  assign sectionSettingsMedia_size = 'large'
                  assign sectionSettingsEnable_video_looping = true
                  assign sectionSettingsGallery_layout = 'stacked'
                  assign sectionSettingsEnable_sticky_info = true
                  assign sectionSettingsMobile_thumbnails = 'show'
                -%}
                            
              {%- assign first_3d_model = card_product.media | where: "media_type", "model" | first -%}
              {%- if first_3d_model -%}
                {{ 'component-product-model.css' | asset_url | stylesheet_tag }}
                <link id="ModelViewerStyle" rel="stylesheet" href="https://cdn.shopify.com/shopifycloud/model-viewer-ui/assets/v1.0/model-viewer-ui.css" media="print" onload="this.media='all'">
                <link id="ModelViewerOverride" rel="stylesheet" href="{{ 'component-model-viewer-ui.css' | asset_url }}" media="print" onload="this.media='all'">
              {%- endif -%}
              
              <section class="page-width section-{{ section.id }}-padding">
                <div class="product product--{{ sectionSettingsMedia_size }} product--{{ sectionSettingsGallery_layout }} grid grid--1-col {% if card_product.media.size > 0 %}grid--2-col-tablet{% else %}product--no-media{% endif %}">
                  <div class="grid__item product__media-wrapper">
                    <media-gallery id="MediaGallery-{{ section.id }}" role="region" {% if sectionSettingsEnable_sticky_info %}class="product__media-gallery"{% endif %} aria-label="{{ 'products.product.media.gallery_viewer' | t }}" data-desktop-layout="{{ sectionSettingsGallery_layout }}">
                      <div id="GalleryStatus-{{ section.id }}" class="visually-hidden" role="status"></div>
                      <slider-component id="GalleryViewer-{{ section.id }}" class="slider-mobile-gutter">
                        <a class="skip-to-content-link button visually-hidden" href="#ProductInfo-{{ section.id }}">
                          {{ "accessibility.skip_to_product_info" | t }}
                        </a>
                        <ul id="Slider-Gallery-{{ section.id }}" class="product__media-list grid grid--peek list-unstyled slider slider--mobile" role="list">
                          {%- liquid
                            assign variant_images = card_product.images | where: 'attached_to_variant?', true | map: 'src'
                            assign media_count = card_product.media.size
                            if sectionSettingsHide_variants
                              assign media_count = media_count | minus: variant_images.size | plus: 1
                            endif
              
                            if sectionSettingsMedia_size == 'large'
                              assign media_width = 0.65
                            elsif sectionSettingsMedia_size == 'medium'
                              assign media_width = 0.55
                            elsif sectionSettingsMedia_size == 'small'
                              assign media_width = 0.45
                            endif
                          -%}
                          {%- if card_product.selected_or_first_available_variant.featured_media != null -%}
                            {%- assign featured_media = card_product.selected_or_first_available_variant.featured_media -%}
                            <li id="Slide-{{ section.id }}-{{ featured_media.id }}" class="product__media-item grid__item slider__slide is-active{% if featured_media.media_type != 'image' %} product__media-item--full{% endif %}{% if sectionSettingsHide_variants and variant_images contains featured_media.src %} product__media-item--variant{% endif %}" data-media-id="{{ section.id }}-{{ featured_media.id }}">
                              {%- assign media_position = 1 -%}
                              {% render 'product-thumbnail', media: featured_media, position: media_position, loop: sectionSettingsEnable_video_looping, modal_id: section.id, xr_button: true, media_width: media_width, lazy_load: false %}
                            </li>
                          {%- endif -%}
                          {%- for media in card_product.media -%}
                            {%- unless media.id == card_product.selected_or_first_available_variant.featured_media.id -%}
                              <li id="Slide-{{ section.id }}-{{ media.id }}" class="product__media-item grid__item slider__slide{% if card_product.selected_or_first_available_variant.featured_media == null and forloop.index == 1 %} is-active{% endif %}{% if media.media_type != 'image' %} product__media-item--full{% endif %}{% if sectionSettingsHide_variants and variant_images contains media.src %} product__media-item--variant{% endif %}" data-media-id="{{ section.id }}-{{ media.id }}">
                                {%- assign media_position = media_position | default: 0 | plus: 1 -%}
                                {% render 'product-thumbnail', media: media, position: media_position, loop: sectionSettingsEnable_video_looping, modal_id: section.id, xr_button: true, media_width: media_width, lazy_load: true %}
                              </li>
                            {%- endunless -%}
                          {%- endfor -%}
                        </ul>
                        <div class="slider-buttons no-js-hidden{% if media_count < 2 or sectionSettingsEnable_sticky_info == 'show' %} small-hide{% endif %}">
                          <button type="button" class="slider-button slider-button--prev" name="previous" aria-label="{{ 'general.slider.previous_slide' | t }}">{% render 'icon-caret' %}</button>
                          <div class="slider-counter caption">
                            <span class="slider-counter--current">1</span>
                            <span aria-hidden="true"> / </span>
                            <span class="visually-hidden">{{ 'general.slider.of' | t }}</span>
                            <span class="slider-counter--total">{{ media_count }}</span>
                          </div>
                          <button type="button" class="slider-button slider-button--next" name="next" aria-label="{{ 'general.slider.next_slide' | t }}">{% render 'icon-caret' %}</button>
                        </div>
                      </slider-component>
                      {%- if first_3d_model -%}
                        <button
                          class="button button--full-width product__xr-button"
                          type="button"
                          aria-label="{{ 'products.product.xr_button_label' | t }}"
                          data-shopify-xr
                          data-shopify-model3d-id="{{ first_3d_model.id }}"
                          data-shopify-title="{{ card_product.title | escape }}"
                          data-shopify-xr-hidden
                        >
                          {% render 'icon-3d-model' %}
                          {{ 'products.product.xr_button' | t }}
                        </button>
                      {%- endif -%}
                      {%- if media_count > 1 and sectionSettingsGallery_layout != 'stacked' or sectionSettingsEnable_sticky_info == 'show' -%}
                        <slider-component id="GalleryThumbnails-{{ section.id }}" class="thumbnail-slider slider-mobile-gutter{% if sectionSettingsEnable_sticky_info == 'hide' %} small-hide{% endif %}{% if media_count <= 3 %} thumbnail-slider--no-slide{% endif %}">
                          <button type="button" class="slider-button slider-button--prev{% if media_count <= 3 %} small-hide{% endif %}{% if media_count <= 4 %} medium-hide large-up-hide{% endif %}" name="previous" aria-label="{{ 'general.slider.previous_slide' | t }}" aria-controls="GalleryThumbnails-{{ section.id }}" data-step="3">{% render 'icon-caret' %}</button>
                          <ul id="Slider-Thumbnails-{{ section.id }}" class="thumbnail-list list-unstyled slider slider--mobile{% if sectionSettingsGallery_layout == 'thumbnail_slider' %} slider--tablet-up{% endif %}">
                            {%- if featured_media != null -%}
                              {%- capture media_index -%}
                                {%- if featured_media.media_type == 'model' -%}{%- increment model_index -%}
                                {%- elsif featured_media.media_type == 'video' or featured_media.media_type == 'external_video' -%}{%- increment video_index -%}
                                {%- elsif featured_media.media_type == 'image'%}{%- increment image_index -%}
                                {%- endif -%}
                              {%- endcapture -%}
                              {%- assign media_index = media_index | plus: 1 -%}
                              <li id="Slide-Thumbnails-{{ section.id }}-0" class="thumbnail-list__item slider__slide{% if sectionSettingsHide_variants and variant_images contains featured_media.src %} thumbnail-list_item--variant{% endif %}" data-target="{{ section.id }}-{{ featured_media.id }}" data-media-position="{{ media_index }}">
                                <button class="thumbnail global-media-settings global-media-settings--no-shadow {% if featured_media.preview_image.aspect_ratio > 1 %}thumbnail--wide{% else %}thumbnail--narrow{% endif %}"
                                  aria-label="{%- if featured_media.media_type == 'image' -%}{{ 'products.product.media.load_image' | t: index: media_index }}{%- elsif featured_media.media_type == 'model' -%}{{ 'products.product.media.load_model' | t: index: media_index }}{%- elsif featured_media.media_type == 'video' or featured_media.media_type == 'external_video' -%}{{ 'products.product.media.load_video' | t: index: media_index }}{%- endif -%}"
                                  aria-current="true"
                                  aria-controls="GalleryViewer-{{ section.id }}"
                                  aria-describedby="Thumbnail-{{ section.id }}-0"
                                >
                                  <img id="Thumbnail-{{ section.id }}-0" srcset="{% if featured_media.preview_image.width >= 54 %}{{ featured_media.preview_image | img_url: '54x' }} 54w,{% endif %}
                                    {% if featured_media.preview_image.width >= 74 %}{{ featured_media.preview_image | img_url: '74x' }} 74w,{% endif %}
                                    {% if featured_media.preview_image.width >= 104 %}{{ featured_media.preview_image | img_url: '104x' }} 104w,{% endif %}
                                    {% if featured_media.preview_image.width >= 162 %}{{ featured_media.preview_image | img_url: '162x' }} 162w,{% endif %}
                                    {% if featured_media.preview_image.width >= 208 %}{{ featured_media.preview_image | img_url: '208x' }} 208w,{% endif %}
                                    {% if featured_media.preview_image.width >= 324 %}{{ featured_media.preview_image | img_url: '324x' }} 324w,{% endif %}
                                    {% if featured_media.preview_image.width >= 416 %}{{ featured_media.preview_image | img_url: '416x' }} 416w,{% endif %},
                                    {{ featured_media.preview_image | img_url: 'master' }} {{ media.preview_image.width }}w"
                                    src="{{ featured_media | img_url: '416x' }}"
                                    sizes="(min-width: {{ settings.page_width }}px) calc(({{ settings.page_width | minus: 100 | times: media_width | round }} - 4rem) / 4), (min-width: 990px) calc(({{ media_width | times: 100 }}vw - 4rem) / 4), (min-width: 750px) calc((100vw - 15rem) / 8), calc((100vw - 14rem) / 3)"
                                    alt="{{ featured_media.alt | escape }}"
                                    height="208"
                                    width="208"
                                    loading="lazy"
                                  >
                                </button>
                              </li>
                            {%- endif -%}
                            {%- for media in card_product.media -%}
                              {%- unless media.id == card_product.selected_or_first_available_variant.featured_media.id -%}
                                {%- capture media_index -%}
                                  {%- if media.media_type == 'model' -%}{%- increment model_index -%}
                                  {%- elsif media.media_type == 'video' or media.media_type == 'external_video' -%}{%- increment video_index -%}
                                  {%- elsif media.media_type == 'image'%}{%- increment image_index -%}
                                  {%- endif -%}
                                {%- endcapture -%}
                                {%- assign media_index = media_index | plus: 1 -%}
                                <li id="Slide-Thumbnails-{{ section.id }}-{{ forloop.index }}" class="thumbnail-list__item slider__slide{% if sectionSettingsHide_variants and variant_images contains media.src %} thumbnail-list_item--variant{% endif %}" data-target="{{ section.id }}-{{ media.id }}"  data-media-position="{{ media_index }}">
                                  {%- if media.media_type == 'model' -%}
                                    <span class="thumbnail__badge" aria-hidden="true">
                                      {%- render 'icon-3d-model' -%}
                                    </span>
                                  {%- elsif media.media_type == 'video' or media.media_type == 'external_video' -%}
                                    <span class="thumbnail__badge" aria-hidden="true">
                                      {%- render 'icon-play' -%}
                                    </span>
                                  {%- endif -%}
                                  <button class="thumbnail global-media-settings global-media-settings--no-shadow {% if media.preview_image.aspect_ratio > 1 %}thumbnail--wide{% else %}thumbnail--narrow{% endif %}"
                                    aria-label="{%- if media.media_type == 'image' -%}{{ 'products.product.media.load_image' | t: index: media_index }}{%- elsif media.media_type == 'model' -%}{{ 'products.product.media.load_model' | t: index: media_index }}{%- elsif media.media_type == 'video' or media.media_type == 'external_video' -%}{{ 'products.product.media.load_video' | t: index: media_index }}{%- endif -%}"
                                    {% if media == card_product.selected_or_first_available_variant.featured_media or card_product.selected_or_first_available_variant.featured_media == null and forloop.index == 1 %} aria-current="true"{% endif %}
                                    aria-controls="GalleryViewer-{{ section.id }}"
                                    aria-describedby="Thumbnail-{{ section.id }}-{{ forloop.index }}"
                                  >
                                    <img id="Thumbnail-{{ section.id }}-{{ forloop.index }}"
                                      srcset="{% if media.preview_image.width >= 59 %}{{ media.preview_image | img_url: '59x' }} 59x,{% endif %}
                                              {% if media.preview_image.width >= 118 %}{{ media.preview_image | img_url: '118x' }} 118w,{% endif %}
                                              {% if media.preview_image.width >= 84 %}{{ media.preview_image | img_url: '84x' }} 84w,{% endif %}
                                              {% if media.preview_image.width >= 168 %}{{ media.preview_image | img_url: '168x' }} 168w,{% endif %}
                                              {% if media.preview_image.width >= 130 %}{{ media.preview_image | img_url: '130x' }} 130w,{% endif %}
                                              {% if media.preview_image.width >= 260 %}{{ media.preview_image | img_url: '260x' }} 260w{% endif %}"
                                      src="{{ media | img_url: '84x84' }}"
                                      sizes="(min-width: 1200px) calc((1200px - 19.5rem) / 12), (min-width: 750px) calc((100vw - 16.5rem) / 8), calc((100vw - 8rem) / 5)"
                                      alt="{{ media.alt | escape }}"
                                      height="200"
                                      width="200"
                                      loading="lazy"
                                    >
                                  </button>
                                </li>
                              {%- endunless -%}
                            {%- endfor -%}
                          </ul>
                          <button type="button" class="slider-button slider-button--next{% if media_count <= 3 %} small-hide{% endif %}{% if media_count <= 4 %} medium-hide large-up-hide{% endif %}" name="next" aria-label="{{ 'general.slider.next_slide' | t }}" aria-controls="GalleryThumbnails-{{ section.id }}" data-step="3">{% render 'icon-caret' %}</button>
                        </slider-component>
                      {%- endif -%}
                    </media-gallery>
                  </div>
                  <div class="product__info-wrapper grid__item{% if settings.page_width > 1400 and sectionSettingsMedia_size == "small" %} product__info-wrapper--extra-padding{% endif %}">
                    <div id="ProductInfo-{{ section.id }}" class="product__info-container{% if sectionSettingsEnable_sticky_info %} product__info-container--sticky{% endif %}">
                      {%- assign product_form_id = 'product-form-' | append: section.id -%}
              
                      <h1 class="product__title">
                        {{ card_product.title | escape }}
                      </h1>

                      <div data-hulkapps-reviews="" data-hulkapps-reviews-product-id="{{ card_product.id }}"></div>

                      <p class="product__text subtitle"></p>

                      <div class="no-js-hidden" id="price-{{ section.id }}" role="status">
                        {%- render 'price', product: card_product, use_variant: true, show_badges: true, price_class: 'price--large' -%}
                      </div>

                      {%- comment -%}
                      {%- if shop.taxes_included or shop.shipping_policy.body != blank -%}
                        <div class="product__tax caption rte">
                          {%- if shop.taxes_included -%}
                            {{ 'products.product.include_taxes' | t }}
                          {%- endif -%}
                          {%- if shop.shipping_policy.body != blank -%}
                            {{ 'products.product.shipping_policy_html' | t: link: shop.shipping_policy.url }}
                          {%- endif -%}
                        </div>
                      {%- endif -%}
                      <div {{ block.shopify_attributes }}>
                        {%- form 'product', card_product, id: 'product-form-installment', class: 'installment caption-large' -%}
                          <input type="hidden" name="id" value="{{ card_product.selected_or_first_available_variant.id }}">
                          {{ form | payment_terms }}
                        {%- endform -%}
                      </div>

                      {%- unless card_product.has_only_default_variant -%}
                        {%- if block.settings.picker_type == 'button' -%}
                          <variant-radios class="no-js-hidden" data-section="{{ section.id }}" data-url="{{ card_product.url }}" {{ block.shopify_attributes }}>
                            {%- for option in card_product.options_with_values -%}
                                <fieldset class="js product-form__input">
                                  <legend class="form__label">{{ option.name }}</legend>
                                  {%- for value in option.values -%}
                                    <input type="radio" id="{{ section.id }}-{{ option.position }}-{{ forloop.index0 }}"
                                          name="{{ option.name }}"
                                          value="{{ value | escape }}"
                                          form="{{ product_form_id }}"
                                          {% if option.selected_value == value %}checked{% endif %}
                                    >
                                    <label for="{{ section.id }}-{{ option.position }}-{{ forloop.index0 }}">
                                      {{ value }}
                                    </label>
                                  {%- endfor -%}
                                </fieldset>
                            {%- endfor -%}
                            <script type="application/json">
                              {{ product.variants | json }}
                            </script>
                          </variant-radios>
                        {%- else -%}
                          <variant-selects class="no-js-hidden" data-section="{{ section.id }}" data-url="{{ card_product.url }}" {{ block.shopify_attributes }}>
                            {%- for option in card_product.options_with_values -%}
                              <div class="product-form__input product-form__input--dropdown">
                                <label class="form__label" for="Option-{{ section.id }}-{{ forloop.index0 }}">
                                  {{ option.name }}
                                </label>
                                <div class="select">
                                  <select id="Option-{{ section.id }}-{{ forloop.index0 }}"
                                    class="select__select"
                                    name="options[{{ option.name | escape }}]"
                                    form="{{ product_form_id }}"
                                  >
                                    {%- for value in option.values -%}
                                      <option value="{{ value | escape }}" {% if option.selected_value == value %}selected="selected"{% endif %}>
                                        {{ value }}
                                      </option>
                                    {%- endfor -%}
                                  </select>
                                  {% render 'icon-caret' %}
                                </div>
                              </div>
                            {%- endfor -%}
          
                            <script type="application/json">
                              {{ card_product.variants | json }}
                            </script>
                          </variant-selects>
                        {%- endif -%}
                      {%- endunless -%}
          
                      <noscript class="product-form__noscript-wrapper-{{ section.id }}">
                        <div class="product-form__input{% if card_product.has_only_default_variant %} hidden{% endif %}">
                          <label class="form__label" for="Variants-{{ section.id }}">{{ 'products.product.product_variants' | t }}</label>
                          <div class="select">
                            <select name="id" id="Variants-{{ section.id }}" class="select__select" form="{{ product_form_id }}">
                              {%- for variant in card_product.variants -%}
                                <option
                                  {% if variant == card_product.selected_or_first_available_variant %}selected="selected"{% endif %}
                                  {% if variant.available == false %}disabled{% endif %}
                                  value="{{ variant.id }}"
                                >
                                  {{ variant.title }}
                                  {%- if variant.available == false %} - {{ 'products.product.sold_out' | t }}{% endif %}
                                  - {{ variant.price | money | strip_html }}
                                </option>
                              {%- endfor -%}
                            </select>
                            {% render 'icon-caret' %}
                          </div>
                        </div>
                      </noscript>

                      <div class="product-form__input product-form__quantity{% if settings.inputs_shadow_vertical_offset != 0 and settings.inputs_shadow_vertical_offset < 0 %} product-form__quantity-top{% endif %}" {{ block.shopify_attributes }}>
                        <label class="form__label" for="Quantity-{{ section.id }}">
                          {{ 'products.product.quantity.label' | t }}
                        </label>
          
                        <quantity-input class="quantity">
                          <button class="quantity__button no-js-hidden" name="minus" type="button">
                            <span class="visually-hidden">{{ 'products.product.quantity.decrease' | t: product: card_product.title | escape }}</span>
                            {% render 'icon-minus' %}
                          </button>
                          <input class="quantity__input"
                              type="number"
                              name="quantity"
                              id="Quantity-{{ section.id }}"
                              min="1"
                              value="1"
                              form="{{ product_form_id }}"
                            >
                          <button class="quantity__button no-js-hidden" name="plus" type="button">
                            <span class="visually-hidden">{{ 'products.product.quantity.increase' | t: product: card_product.title | escape }}</span>
                            {% render 'icon-plus' %}
                          </button>
                        </quantity-input>
                      </div>

                      <div {{ block.shopify_attributes }}>
                        <product-form class="product-form">
                          <div class="product-form__error-message-wrapper" role="alert" hidden>
                            <svg aria-hidden="true" focusable="false" role="presentation" class="icon icon-error" viewBox="0 0 13 13">
                              <circle cx="6.5" cy="6.50049" r="5.5" stroke="white" stroke-width="2"/>
                              <circle cx="6.5" cy="6.5" r="5.5" fill="#EB001B" stroke="#EB001B" stroke-width="0.7"/>
                              <path d="M5.87413 3.52832L5.97439 7.57216H7.02713L7.12739 3.52832H5.87413ZM6.50076 9.66091C6.88091 9.66091 7.18169 9.37267 7.18169 9.00504C7.18169 8.63742 6.88091 8.34917 6.50076 8.34917C6.12061 8.34917 5.81982 8.63742 5.81982 9.00504C5.81982 9.37267 6.12061 9.66091 6.50076 9.66091Z" fill="white"/>
                              <path d="M5.87413 3.17832H5.51535L5.52424 3.537L5.6245 7.58083L5.63296 7.92216H5.97439H7.02713H7.36856L7.37702 7.58083L7.47728 3.537L7.48617 3.17832H7.12739H5.87413ZM6.50076 10.0109C7.06121 10.0109 7.5317 9.57872 7.5317 9.00504C7.5317 8.43137 7.06121 7.99918 6.50076 7.99918C5.94031 7.99918 5.46982 8.43137 5.46982 9.00504C5.46982 9.57872 5.94031 10.0109 6.50076 10.0109Z" fill="white" stroke="#EB001B" stroke-width="0.7">
                            </svg>
                            <span class="product-form__error-message"></span>
                          </div>
          
                          {%- form 'product', card_product, id: product_form_id, class: 'form', novalidate: 'novalidate', data-type: 'add-to-cart-form' -%}
                            <input type="hidden" name="id" value="{{ card_product.selected_or_first_available_variant.id }}" disabled>
                            <div class="product-form__buttons">
                                              {% render 'assemble', type: 'product-plan' %}
                              
                              <button
                                type="submit"
                                name="add"
                                class="product-form__submit js-go-cart-add-to-cart button button--full-width {% if block.settings.show_dynamic_checkout and card_product.selling_plan_groups == empty %}button--secondary{% else %}button--primary{% endif %}"
                              {% if card_product.selected_or_first_available_variant.available == false %}disabled{% endif %}
                              >
                                  
                                    {%- if card_product.selected_or_first_available_variant.available -%}
                                      {{ 'products.product.add_to_cart' | t }}
                                    {%- else -%}
                                      {{ 'products.product.sold_out' | t }}
                                    {%- endif -%}
                                  
                                  <div class="loading-overlay__spinner hidden">
                                    <svg aria-hidden="true" focusable="false" role="presentation" class="spinner" viewBox="0 0 66 66" xmlns="http://www.w3.org/2000/svg">
                                      <circle class="path" fill="none" stroke-width="6" cx="33" cy="33" r="30"></circle>
                                    </svg>
                                  </div>
                              </button>
                              {%- if block.settings.show_dynamic_checkout -%}
                                {{ form | payment_button }}
                              {%- endif -%}
                            </div>
                          {%- endform -%}
                        </product-form>
                        {{ 'component-pickup-availability.css' | asset_url | stylesheet_tag }}
          
                        {%- assign pick_up_availabilities = card_product.selected_or_first_available_variant.store_availabilities | where: 'pick_up_enabled', true -%}
          
                        <pickup-availability class="product__pickup-availabilities no-js-hidden"
                          {% if card_product.selected_or_first_available_variant.available and pick_up_availabilities.size > 0 %} available{% endif %}
                          data-root-url="{{ routes.root_url }}"
                          data-variant-id="{{ card_product.selected_or_first_available_variant.id }}"
                          data-has-only-default-variant="{{ card_product.has_only_default_variant }}"
                        >
                          <template>
                            <pickup-availability-preview class="pickup-availability-preview">
                              {% render 'icon-unavailable' %}
                              <div class="pickup-availability-info">
                                <p class="caption-large">{{ 'products.product.pickup_availability.unavailable' | t }}</p>
                                <button class="pickup-availability-button link link--text underlined-link">{{ 'products.product.pickup_availability.refresh' | t }}</button>
                              </div>
                            </pickup-availability-preview>
                          </template>
                        </pickup-availability>
                      </div>
          
                      <script src="{{ 'pickup-availability.js' | asset_url }}" defer="defer"></script>
                      {%- endcomment -%}

                      <button type="button" class="button addtocart-btn{% if variant_card == nil %} disabled{% endif %}"{% if variant_card == nil %} disabled{% endif %} data-id="{{variant_card.id}}" data-product-count="{{ cart_count_product }}" data-product-selling-plan-id="{{productSellingPlanId}}">{% if variant_card == nil %}Sold Out{% else %}{% if cart_count_product == 0 %}Add to Cart{% else %}Add 1 More{% endif %}{% endif %}</button>

                      {%- if card_product.description != blank -%}
                        <div class="product__description rte">
                          {{ card_product.description }}
                        </div>
                      {%- endif -%}

                      {%- comment -%}
                      {%- for block in section.blocks -%}
                        {%- case block.type -%}
                        {%- when '@app' -%}
                          {% render block %}
                        {%- when 'text' -%}
                          <p class="product__text{% if block.settings.text_style == 'uppercase' %} caption-with-letter-spacing{% elsif block.settings.text_style == 'subtitle' %} subtitle{% endif %}" {{ block.shopify_attributes }}>
                            {{- block.settings.text -}}
                          </p>
                        {%- when 'title' -%}
                        <div data-hulkapps-reviews data-hulkapps-reviews-product-id="{{ card_product.id }}"></div>
                        {%- when 'price' -%}
                          <div class="no-js-hidden" id="price-{{ section.id }}" role="status" {{ block.shopify_attributes }}>
                            {%- render 'price', product: card_product, use_variant: true, show_badges: true, price_class: 'price--large' -%}
                          </div>
                          {%- if shop.taxes_included or shop.shipping_policy.body != blank -%}
                            <div class="product__tax caption rte">
                              {%- if shop.taxes_included -%}
                                {{ 'products.product.include_taxes' | t }}
                              {%- endif -%}
                              {%- if shop.shipping_policy.body != blank -%}
                                {{ 'products.product.shipping_policy_html' | t: link: shop.shipping_policy.url }}
                              {%- endif -%}
                            </div>
                          {%- endif -%}
                          <div {{ block.shopify_attributes }}>
                            {%- form 'product', card_product, id: 'product-form-installment', class: 'installment caption-large' -%}
                              <input type="hidden" name="id" value="{{ card_product.selected_or_first_available_variant.id }}">
                              {{ form | payment_terms }}
                            {%- endform -%}
                          </div>
                        {%- when 'description' -%}
                          {%- if card_product.description != blank -%}
                            <div class="product__description rte">
                              {{ card_product.description }}
                            </div>
                          {%- endif -%}
                        {%- when 'custom_liquid' -%}
                          {{ block.settings.custom_liquid }}
                        {%- when 'collapsible_tab' -%}
                          <div class="product__accordion accordion" {{ block.shopify_attributes }}>
                            <details id="Details-{{ block.id }}-{{ section.id }}">
                              <summary>
                                <div class="summary__title">
                                  {% render 'icon-accordion', icon: block.settings.icon %}
                                  <h2 class="h4 accordion__title">
                                    {{ block.settings.heading | default: block.settings.page.title }}
                                  </h2>
                                </div>
                                {% render 'icon-caret' %}
                              </summary>
                              <div class="accordion__content rte" id="ProductAccordion-{{ block.id }}-{{ section.id }}">
                                {{ block.settings.content }}
                                {{ block.settings.page.content }}
                              </div>
                            </details>
                          </div>
                        {%- when 'quantity_selector' -%}
                          <div class="product-form__input product-form__quantity{% if settings.inputs_shadow_vertical_offset != 0 and settings.inputs_shadow_vertical_offset < 0 %} product-form__quantity-top{% endif %}" {{ block.shopify_attributes }}>
                            <label class="form__label" for="Quantity-{{ section.id }}">
                              {{ 'products.product.quantity.label' | t }}
                            </label>
              
                            <quantity-input class="quantity">
                              <button class="quantity__button no-js-hidden" name="minus" type="button">
                                <span class="visually-hidden">{{ 'products.product.quantity.decrease' | t: product: card_product.title | escape }}</span>
                                {% render 'icon-minus' %}
                              </button>
                              <input class="quantity__input"
                                  type="number"
                                  name="quantity"
                                  id="Quantity-{{ section.id }}"
                                  min="1"
                                  value="1"
                                  form="{{ product_form_id }}"
                                >
                              <button class="quantity__button no-js-hidden" name="plus" type="button">
                                <span class="visually-hidden">{{ 'products.product.quantity.increase' | t: product: card_product.title | escape }}</span>
                                {% render 'icon-plus' %}
                              </button>
                            </quantity-input>
                          </div>
                        {%- when 'popup' -%}
                            <modal-opener class="product-popup-modal__opener no-js-hidden" data-modal="#PopupModal-{{ block.id }}" {{ block.shopify_attributes }}>
                              <button id="ProductPopup-{{ block.id }}" class="product-popup-modal__button link" type="button" aria-haspopup="dialog">{{ block.settings.text | default: block.settings.page.title }}</button>
                            </modal-opener>
                            <a href="{{ block.settings.page.url }}" class="product-popup-modal__button link no-js">{{ block.settings.text }}</a>
                        {%- when 'share' -%}
                          <share-button id="Share-{{ section.id }}" class="share-button" {{ block.shopify_attributes }}>
                            <button class="share-button__button hidden">
                              {% render 'icon-share' %}
                              {{ block.settings.share_label | escape }}
                            </button>
                            <details id="Details-{{ block.id }}-{{ section.id }}">
                              <summary class="share-button__button">
                                {% render 'icon-share' %}
                                {{ block.settings.share_label | escape }}
                              </summary>
                              <div id="Product-share-{{ section.id }}" class="share-button__fallback motion-reduce">
                                <div class="field">
                                  <span id="ShareMessage-{{ section.id }}" class="share-button__message hidden" role="status">
                                  </span>
                                  <input type="text"
                                        class="field__input"
                                        id="url"
                                        value="{{ card_product.selected_variant.url | default: card_product.url | prepend: shop.url }}"
                                        placeholder="{{ 'general.share.share_url' | t }}"
                                        onclick="this.select();"
                                        readonly
                                  >
                                  <label class="field__label" for="url">{{ 'general.share.share_url' | t }}</label>
                                </div>
                                <button class="share-button__close hidden no-js-hidden">
                                  {% render 'icon-close' %}
                                  <span class="visually-hidden">{{ 'general.share.close' | t }}</span>
                                </button>
                                <button class="share-button__copy no-js-hidden">
                                  {% render 'icon-clipboard' %}
                                  <span class="visually-hidden">{{ 'general.share.copy_to_clipboard' | t }}</span>
                                </button>
                              </div>
                            </details>
                          </share-button>
                          <script src="{{ 'share.js' | asset_url }}" defer="defer"></script>
                        {%- when 'variant_picker' -%}
                          {%- unless card_product.has_only_default_variant -%}
                            {%- if block.settings.picker_type == 'button' -%}
                              <variant-radios class="no-js-hidden" data-section="{{ section.id }}" data-url="{{ card_product.url }}" {{ block.shopify_attributes }}>
                                {%- for option in card_product.options_with_values -%}
                                    <fieldset class="js product-form__input">
                                      <legend class="form__label">{{ option.name }}</legend>
                                      {%- for value in option.values -%}
                                        <input type="radio" id="{{ section.id }}-{{ option.position }}-{{ forloop.index0 }}"
                                              name="{{ option.name }}"
                                              value="{{ value | escape }}"
                                              form="{{ product_form_id }}"
                                              {% if option.selected_value == value %}checked{% endif %}
                                        >
                                        <label for="{{ section.id }}-{{ option.position }}-{{ forloop.index0 }}">
                                          {{ value }}
                                        </label>
                                      {%- endfor -%}
                                    </fieldset>
                                {%- endfor -%}
                                <script type="application/json">
                                  {{ product.variants | json }}
                                </script>
                              </variant-radios>
                            {%- else -%}
                              <variant-selects class="no-js-hidden" data-section="{{ section.id }}" data-url="{{ card_product.url }}" {{ block.shopify_attributes }}>
                                {%- for option in card_product.options_with_values -%}
                                  <div class="product-form__input product-form__input--dropdown">
                                    <label class="form__label" for="Option-{{ section.id }}-{{ forloop.index0 }}">
                                      {{ option.name }}
                                    </label>
                                    <div class="select">
                                      <select id="Option-{{ section.id }}-{{ forloop.index0 }}"
                                        class="select__select"
                                        name="options[{{ option.name | escape }}]"
                                        form="{{ product_form_id }}"
                                      >
                                        {%- for value in option.values -%}
                                          <option value="{{ value | escape }}" {% if option.selected_value == value %}selected="selected"{% endif %}>
                                            {{ value }}
                                          </option>
                                        {%- endfor -%}
                                      </select>
                                      {% render 'icon-caret' %}
                                    </div>
                                  </div>
                                {%- endfor -%}
              
                                <script type="application/json">
                                  {{ card_product.variants | json }}
                                </script>
                              </variant-selects>
                            {%- endif -%}
                          {%- endunless -%}
              
                          <noscript class="product-form__noscript-wrapper-{{ section.id }}">
                            <div class="product-form__input{% if card_product.has_only_default_variant %} hidden{% endif %}">
                              <label class="form__label" for="Variants-{{ section.id }}">{{ 'products.product.product_variants' | t }}</label>
                              <div class="select">
                                <select name="id" id="Variants-{{ section.id }}" class="select__select" form="{{ product_form_id }}">
                                  {%- for variant in card_product.variants -%}
                                    <option
                                      {% if variant == card_product.selected_or_first_available_variant %}selected="selected"{% endif %}
                                      {% if variant.available == false %}disabled{% endif %}
                                      value="{{ variant.id }}"
                                    >
                                      {{ variant.title }}
                                      {%- if variant.available == false %} - {{ 'products.product.sold_out' | t }}{% endif %}
                                      - {{ variant.price | money | strip_html }}
                                    </option>
                                  {%- endfor -%}
                                </select>
                                {% render 'icon-caret' %}
                              </div>
                            </div>
                          </noscript>
                        {%- when 'buy_buttons' -%}
                          <div {{ block.shopify_attributes }}>
                            <product-form class="product-form">
                              <div class="product-form__error-message-wrapper" role="alert" hidden>
                                <svg aria-hidden="true" focusable="false" role="presentation" class="icon icon-error" viewBox="0 0 13 13">
                                  <circle cx="6.5" cy="6.50049" r="5.5" stroke="white" stroke-width="2"/>
                                  <circle cx="6.5" cy="6.5" r="5.5" fill="#EB001B" stroke="#EB001B" stroke-width="0.7"/>
                                  <path d="M5.87413 3.52832L5.97439 7.57216H7.02713L7.12739 3.52832H5.87413ZM6.50076 9.66091C6.88091 9.66091 7.18169 9.37267 7.18169 9.00504C7.18169 8.63742 6.88091 8.34917 6.50076 8.34917C6.12061 8.34917 5.81982 8.63742 5.81982 9.00504C5.81982 9.37267 6.12061 9.66091 6.50076 9.66091Z" fill="white"/>
                                  <path d="M5.87413 3.17832H5.51535L5.52424 3.537L5.6245 7.58083L5.63296 7.92216H5.97439H7.02713H7.36856L7.37702 7.58083L7.47728 3.537L7.48617 3.17832H7.12739H5.87413ZM6.50076 10.0109C7.06121 10.0109 7.5317 9.57872 7.5317 9.00504C7.5317 8.43137 7.06121 7.99918 6.50076 7.99918C5.94031 7.99918 5.46982 8.43137 5.46982 9.00504C5.46982 9.57872 5.94031 10.0109 6.50076 10.0109Z" fill="white" stroke="#EB001B" stroke-width="0.7">
                                </svg>
                                <span class="product-form__error-message"></span>
                              </div>
              
                              {%- form 'product', card_product, id: product_form_id, class: 'form', novalidate: 'novalidate', data-type: 'add-to-cart-form' -%}
                                <input type="hidden" name="id" value="{{ card_product.selected_or_first_available_variant.id }}" disabled>
                                <div class="product-form__buttons">
                                                  {% render 'assemble', type: 'product-plan' %}
                                  
                                  <button
                                    type="submit"
                                    name="add"
                                    class="product-form__submit js-go-cart-add-to-cart button button--full-width {% if block.settings.show_dynamic_checkout and card_product.selling_plan_groups == empty %}button--secondary{% else %}button--primary{% endif %}"
                                  {% if card_product.selected_or_first_available_variant.available == false %}disabled{% endif %}
                                  >
                                      
                                        {%- if card_product.selected_or_first_available_variant.available -%}
                                          {{ 'products.product.add_to_cart' | t }}
                                        {%- else -%}
                                          {{ 'products.product.sold_out' | t }}
                                        {%- endif -%}
                                      
                                      <div class="loading-overlay__spinner hidden">
                                        <svg aria-hidden="true" focusable="false" role="presentation" class="spinner" viewBox="0 0 66 66" xmlns="http://www.w3.org/2000/svg">
                                          <circle class="path" fill="none" stroke-width="6" cx="33" cy="33" r="30"></circle>
                                        </svg>
                                      </div>
                                  </button>
                                  {%- if block.settings.show_dynamic_checkout -%}
                                    {{ form | payment_button }}
                                  {%- endif -%}
                                </div>
                              {%- endform -%}
                            </product-form>
                            {{ 'component-pickup-availability.css' | asset_url | stylesheet_tag }}
              
                            {%- assign pick_up_availabilities = card_product.selected_or_first_available_variant.store_availabilities | where: 'pick_up_enabled', true -%}
              
                            <pickup-availability class="product__pickup-availabilities no-js-hidden"
                              {% if card_product.selected_or_first_available_variant.available and pick_up_availabilities.size > 0 %} available{% endif %}
                              data-root-url="{{ routes.root_url }}"
                              data-variant-id="{{ card_product.selected_or_first_available_variant.id }}"
                              data-has-only-default-variant="{{ card_product.has_only_default_variant }}"
                            >
                              <template>
                                <pickup-availability-preview class="pickup-availability-preview">
                                  {% render 'icon-unavailable' %}
                                  <div class="pickup-availability-info">
                                    <p class="caption-large">{{ 'products.product.pickup_availability.unavailable' | t }}</p>
                                    <button class="pickup-availability-button link link--text underlined-link">{{ 'products.product.pickup_availability.refresh' | t }}</button>
                                  </div>
                                </pickup-availability-preview>
                              </template>
                            </pickup-availability>
                          </div>
              
                          <script src="{{ 'pickup-availability.js' | asset_url }}" defer="defer"></script>
                        {%- when 'rating' -%}
                          {%- if card_product.metafields.reviews.rating.value != blank -%}
                            {% liquid
                            assign rating_decimal = 0
                            assign decimal = card_product.metafields.reviews.rating.value.rating | modulo: 1
                            if decimal >= 0.3 and decimal <= 0.7
                              assign rating_decimal = 0.5
                            elsif decimal > 0.7
                              assign rating_decimal = 1
                            endif
                            %}
                                                    <div data-hulkapps-reviews data-hulkapps-reviews-list></div>
              
                            <div class="rating" role="img" aria-label="{{ 'accessibility.star_reviews_info' | t: rating_value: card_product.metafields.reviews.rating.value, rating_max: card_product.metafields.reviews.rating.value.scale_max }}">
                              <span aria-hidden="true" class="rating-star color-icon-{{ settings.accent_icons }}" style="--rating: {{ card_product.metafields.reviews.rating.value.rating | floor }}; --rating-max: {{ card_product.metafields.reviews.rating.value.scale_max }}; --rating-decimal: {{ rating_decimal }};"></span>
                            </div>
                            <p class="rating-text caption">
                              <span aria-hidden="true">{{ card_product.metafields.reviews.rating.value }} / {{ card_product.metafields.reviews.rating.value.scale_max }}</span>
                            </p>
                            <p class="rating-count caption">
                              <span aria-hidden="true">({{ card_product.metafields.reviews.rating_count }})</span>
                              <span class="visually-hidden">{{ card_product.metafields.reviews.rating_count }} {{ "accessibility.total_reviews" | t }}</span>
                            </p>
                          {%- endif -%}
                        {%- endcase -%}
                      {%- endfor -%}
                      {%- endcomment -%}

                    </div>
                  </div>
                </div>
              </section>
              
              
              {% if card_product.media.size > 0 %}
                <script src="{{ 'media-gallery.js' | asset_url }}" defer="defer"></script>
              {% endif %}




              </div>
            </div>
          </modal-dialog>

          <button type="button" class="btn addtocart-btn{% if variant_card == nil %} disabled{% endif %}"{% if variant_card == nil %} disabled{% endif %} data-id="{{variant_card.id}}" data-product-count="{{ cart_count_product }}" data-product-selling-plan-id="{{productSellingPlanId}}">{% if variant_card == nil %}Sold Out{% else %}{% if cart_count_product == 0 %}Add to Cart{% else %}Add 1 More{% endif %}{% endif %}</button>
  
          <button type="button" class="btn removetocart-btn" style="display:none;" data-id="{{variant_card.id}}" data-product-count="{{ cart_count_product }}" data-product-selling-plan-id="{{productSellingPlanId}}" data-text="Remove">Remove</button>  
        </div>
      </div>
      <div class="card__content">
        <div class="card__information">
          <h3 class="card__heading{% if card_product.featured_media or settings.card_style == 'standard' %} h5{% endif %}">
            {% comment %}<a href="{{ card_product.url | default: '#' }}" class="full-unstyled-link">{% endcomment %}
              {{ card_product.title | escape }}
            {% comment %}</a>{% endcomment %}
          </h3>

          <div data-hulkapps-reviews data-hulkapps-reviews-product-id="{{ card_product.id }}"></div>
          <div class="card-information">
            {%- if show_vendor -%}
              <span class="visually-hidden">{{ 'accessibility.vendor' | t }}</span>
              <div class="caption-with-letter-spacing light">{{ card_product.vendor }}</div>
            {%- endif -%}

            <span class="caption-large light">{{ block.settings.description | escape }}</span>

            {%- if show_rating and card_product.metafields.reviews.rating.value != blank -%}
              {% liquid
                assign rating_decimal = 0
                assign decimal = card_product.metafields.reviews.rating.value.rating | modulo: 1
                if decimal >= 0.3 and decimal <= 0.7
                  assign rating_decimal = 0.5
                elsif decimal > 0.7
                  assign rating_decimal = 1
                endif
              %}
              <div class="rating" role="img" aria-label="{{ 'accessibility.star_reviews_info' | t: rating_value: card_product.metafields.reviews.rating.value, rating_max: card_product.metafields.reviews.rating.value.scale_max }}">
                <span aria-hidden="true" class="rating-star color-icon-{{ settings.accent_icons }}" style="--rating: {{ card_product.metafields.reviews.rating.value.rating | floor }}; --rating-max: {{ card_product.metafields.reviews.rating.value.scale_max }}; --rating-decimal: {{ rating_decimal }};"></span>
              </div>
              <p class="rating-text caption">
                <span aria-hidden="true">{{ card_product.metafields.reviews.rating.value }} / {{ card_product.metafields.reviews.rating.value.scale_max }}</span>
              </p>
              <p class="rating-count caption">
                <span aria-hidden="true">({{ card_product.metafields.reviews.rating_count }})</span>
                <span class="visually-hidden">{{ card_product.metafields.reviews.rating_count }} {{ "accessibility.total_reviews" | t }}</span>
              </p>
            {%- endif -%}

            {% render 'price', product: card_product, price_class: '' %}


            {% comment %}
            <product-form-{{ card_product.id }} class="">
              {%- assign product_form_id = 'product-form-' | append: card_product.id -%}
              {%- form 'product', card_product, id: product_form_id, class: 'form', novalidate: 'novalidate', data-type: 'add-to-cart-form' -%}
                <input type="hidden" id="Quantity-{{ card_product.id }}" value="1" min="1" aria-label="quantity" pattern="[0-9]*" name="quantity">
                <input type="hidden" name="id" value="{{ card_product.selected_or_first_available_variant.id }}">
                <div class="product-form__buttons product-form__buttons--plp">
                  <button
                    type="submit"
                    name="add"
                    id = "submit-{{ product_form_id }}"
                    class="product-form__submit js-go-cart-add-to-cart button button--full-width button--primary"
                  {% if card_product.selected_or_first_available_variant.available == false %}disabled{% endif %}
                  >
                      
                        {%- if card_product.selected_or_first_available_variant.available -%}
                          {{ 'products.product.add_to_cart' | t }}
                        {%- else -%}
                          {{ 'products.product.sold_out' | t }}
                        {%- endif -%}
                      
                      <div class="loading-overlay__spinner hidden">
                        <svg aria-hidden="true" focusable="false" role="presentation" class="spinner" viewBox="0 0 66 66" xmlns="http://www.w3.org/2000/svg">
                          <circle class="path" fill="none" stroke-width="6" cx="33" cy="33" r="30"></circle>
                        </svg>
                      </div>
                  </button>
                </div>
              {%- endform -%}
            </product-form-{{ card_product.id }}>
            <div class="product-form__error-message-wrapper" id="product-form__error-message-wrapper-{{ card_product.id }}" role="alert" hidden>
              <svg aria-hidden="true" focusable="false" role="presentation" class="icon icon-error" viewBox="0 0 13 13">
                <circle cx="6.5" cy="6.50049" r="5.5" stroke="white" stroke-width="2"/>
                <circle cx="6.5" cy="6.5" r="5.5" fill="#EB001B" stroke="#EB001B" stroke-width="0.7"/>
                <path d="M5.87413 3.52832L5.97439 7.57216H7.02713L7.12739 3.52832H5.87413ZM6.50076 9.66091C6.88091 9.66091 7.18169 9.37267 7.18169 9.00504C7.18169 8.63742 6.88091 8.34917 6.50076 8.34917C6.12061 8.34917 5.81982 8.63742 5.81982 9.00504C5.81982 9.37267 6.12061 9.66091 6.50076 9.66091Z" fill="white"/>
                <path d="M5.87413 3.17832H5.51535L5.52424 3.537L5.6245 7.58083L5.63296 7.92216H5.97439H7.02713H7.36856L7.37702 7.58083L7.47728 3.537L7.48617 3.17832H7.12739H5.87413ZM6.50076 10.0109C7.06121 10.0109 7.5317 9.57872 7.5317 9.00504C7.5317 8.43137 7.06121 7.99918 6.50076 7.99918C5.94031 7.99918 5.46982 8.43137 5.46982 9.00504C5.46982 9.57872 5.94031 10.0109 6.50076 10.0109Z" fill="white" stroke="#EB001B" stroke-width="0.7">
              </svg>
              <span class="product-form__error-message" id="product-form__error-message-{{ card_product.id }}"></span>
            </div>          
            {% render 'plp-product-form', product_id: card_product.id %}
            {% endcomment %}
          </div>
        </div>
        <div class="card__badge {{ settings.badge_position }}">
          {%- if card_product.available == false -%}
            <span class="badge badge--bottom-left color-{{ settings.sold_out_badge_color_scheme }}">{{ 'products.product.sold_out' | t }}</span>
          {%- elsif card_product.compare_at_price > card_product.price and card_product.available -%}
            <span class="badge badge--bottom-left color-{{ settings.sale_badge_color_scheme }}">{{ 'products.product.on_sale' | t }}</span>
          {%- endif -%}
        </div>       
        <div class="card_product-options">
          <modal-opener class="product-popup-modal__opener no-js-hidden" data-modal="#PopupModal-{{ section.id }}-{{ card_product.id }}" style="width:100%;">
            <button id="ProductPopup-{{ card_product }}" class="btn product-popup-modal__button" type="button" aria-haspopup="dialog">Show More</button>
          </modal-opener>
          <button type="button" class="btn addtocart-btn{% if variant_card == nil %} disabled{% endif %}"{% if variant_card == nil %} disabled{% endif %} data-id="{{variant_card.id}}" data-product-count="{{ cart_count_product }}" data-product-selling-plan-id="{{productSellingPlanId}}">{% if variant_card == nil %}Sold Out{% else %}{% if cart_count_product == 0 %}Add to Cart{% else %}Add 1 More{% endif %}{% endif %}</button>
        </div>
      </div>
    </div>
  </div>
{%- else -%}
  <div class="card-wrapper underline-links-hover">
    <div class="card
      card--{{ settings.card_style }}
      card--text
      {% if extend_height %} card--extend-height{% endif %}
      {% if settings.card_style == 'card' %} color-{{ settings.card_color_scheme }}{% endif %}
      {% if card_product.featured_media == nil and settings.card_style == 'card' %} ratio{% endif %}"
      style="--ratio-percent: 100%;"
    >
      <div class="card__inner {% if settings.card_style == 'standard' %}color-{{ settings.card_color_scheme }}{% endif %}{% if settings.card_style == 'standard' %} ratio{% endif %}" style="--ratio-percent: 100%;">
        <div class="card__content">
          <div class="card__information">
            <h3 class="card__heading">
              <a href="#" class="full-unstyled-link">
                {{ 'onboarding.product_title' | t }}
              </a>
            </h3>
          </div>
        </div>
      </div>
      <div class="card__content">
        <div class="card__information">
          <h3 class="card__heading{% if settings.card_style == 'standard' %} h5{% endif %}">
            <a href="#" class="full-unstyled-link">
              {{ 'onboarding.product_title' | t }}
            </a>
          </h3>
          <div class="card-information">
            {%- if show_vendor -%}
              <span class="visually-hidden">{{ 'accessibility.vendor' | t }}</span>
              <div class="caption-with-letter-spacing light">{{ 'products.product.vendor' | t }}</div>
            {%- endif -%}
            {% render 'price' %}
          </div>
        </div>
      </div>
    </div>
  </div>
{%- endif -%}